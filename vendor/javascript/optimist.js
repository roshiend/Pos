import e from"path";import r from"wordwrap";import t from"process";var n={};var a={exports:n};var o=t;var i=e;var s=r;var c=Argv(o.argv.slice(2));Object.keys(c).forEach((function(e){Argv[e]="function"==typeof c[e]?c[e].bind(c):c[e]}));var n=a.exports=Argv;function Argv(e,r){var t={};r||(r=o.cwd());t.$0=o.argv.slice(0,2).map((function(e){var t=rebase(r,e);return e.match(/^\//)&&t.length<e.length?t:e})).join(" ");void 0!=o.env._&&o.argv[1]==o.env._&&(t.$0=o.env._.replace(i.dirname(o.execPath)+"/",""));var n={bools:{},strings:{}};t.boolean=function(e){Array.isArray(e)||(e=[].slice.call(arguments));e.forEach((function(e){n.bools[e]=true}));return t};t.string=function(e){Array.isArray(e)||(e=[].slice.call(arguments));e.forEach((function(e){n.strings[e]=true}));return t};var a={};t.alias=function(e,r){if("object"===typeof e)Object.keys(e).forEach((function(r){t.alias(r,e[r])}));else if(Array.isArray(r))r.forEach((function(r){t.alias(e,r)}));else{var n=(a[e]||[]).concat(a[r]||[]).concat(e,r);a[e]=n.filter((function(r){return r!=e}));a[r]=n.filter((function(e){return e!=r}))}return t};var c={};t.demand=function(e){if("number"==typeof e){c._||(c._=0);c._+=e}else Array.isArray(e)?e.forEach((function(e){t.demand(e)})):c[e]=true;return t};var l;t.usage=function(e,r){if(!r&&"object"===typeof e){r=e;e=null}l=e;r&&t.options(r);return t};function fail(e){t.showHelp();e&&console.error(e);o.exit(1)}var f=[];t.check=function(e){f.push(e);return t};var u={};t.default=function(e,r){"object"===typeof e?Object.keys(e).forEach((function(r){t.default(r,e[r])})):u[e]=r;return t};var v={};t.describe=function(e,r){"object"===typeof e?Object.keys(e).forEach((function(r){t.describe(r,e[r])})):v[e]=r;return t};t.parse=function(e){return Argv(e).argv};t.option=t.options=function(e,r){if("object"===typeof e)Object.keys(e).forEach((function(r){t.options(r,e[r])}));else{r.alias&&t.alias(e,r.alias);r.demand&&t.demand(e);"undefined"!==typeof r.default&&t.default(e,r.default);(r.boolean||"boolean"===r.type)&&t.boolean(e);(r.string||"string"===r.type)&&t.string(e);var n=r.describe||r.description||r.desc;n&&t.describe(e,n)}return t};var g=null;t.wrap=function(e){g=e;return t};t.showHelp=function(e){e||(e=console.error);e(t.help())};t.help=function(){var e=Object.keys(Object.keys(v).concat(Object.keys(c)).concat(Object.keys(u)).reduce((function(e,r){"_"!==r&&(e[r]=true);return e}),{}));var r=e.length?["Options:"]:[];l&&r.unshift(l.replace(/\$0/g,t.$0),"");var o=e.reduce((function(e,r){e[r]=[r].concat(a[r]||[]).map((function(e){return(e.length>1?"--":"-")+e})).join(", ");return e}),{});var i=longest(Object.keys(o).map((function(e){return o[e]||""})));var f=longest(Object.keys(v).map((function(e){return v[e]||""})));e.forEach((function(e){var t=o[e];var a=v[e]||"";g&&(a=s(i+4,g)(a).slice(i+4));var l=new Array(Math.max(i-t.length+3,0)).join(" ");var h=new Array(Math.max(f-a.length+1,0)).join(" ");var p=null;n.bools[e]&&(p="[boolean]");n.strings[e]&&(p="[string]");!g&&h.length>0&&(a+=h);var b="  "+t+l;var y=[p,c[e]?"[required]":null,void 0!==u[e]?"[default: "+JSON.stringify(u[e])+"]":null].filter(Boolean).join("  ");var m=[a,y].filter(Boolean).join("  ");if(g){var d=a.split("\n");var A=d.slice(-1)[0].length+(1===d.length?b.length:0);m=a+(A+y.length>g-2?"\n"+new Array(g-y.length+1).join(" ")+y:new Array(g-y.length-A+1).join(" ")+y)}r.push(b+m)}));r.push("");return r.join("\n")};Object.defineProperty(t,"argv",{get:parseArgs,enumerable:true});function parseArgs(){var r={_:[],$0:t.$0};Object.keys(n.bools).forEach((function(e){setArg(e,u[e]||false)}));function setArg(e,t){var o=Number(t);var i="string"!==typeof t||isNaN(o)?t:o;n.strings[e]&&(i=t);setKey(r,e.split("."),i);(a[e]||[]).forEach((function(t){r[t]=r[e]}))}for(var o=0;o<e.length;o++){var i=e[o];if("--"===i){r._.push.apply(r._,e.slice(o+1));break}if(i.match(/^--.+=/)){var s=i.match(/^--([^=]+)=([\s\S]*)$/);setArg(s[1],s[2])}else if(i.match(/^--no-.+/)){var l=i.match(/^--no-(.+)/)[1];setArg(l,false)}else if(i.match(/^--.+/)){var l=i.match(/^--(.+)/)[1];var v=e[o+1];if(void 0===v||v.match(/^-/)||n.bools[l]||a[l]&&n.bools[a[l]])if(/^(true|false)$/.test(v)){setArg(l,"true"===v);o++}else setArg(l,true);else{setArg(l,v);o++}}else if(i.match(/^-[^-]+/)){var g=i.slice(1,-1).split("");var h=false;for(var p=0;p<g.length;p++){if(g[p+1]&&g[p+1].match(/\W/)){setArg(g[p],i.slice(p+2));h=true;break}setArg(g[p],true)}if(!h){var l=i.slice(-1)[0];if(!e[o+1]||e[o+1].match(/^-/)||n.bools[l]||a[l]&&n.bools[a[l]])if(e[o+1]&&/true|false/.test(e[o+1])){setArg(l,"true"===e[o+1]);o++}else setArg(l,true);else{setArg(l,e[o+1]);o++}}}else{var b=Number(i);r._.push(n.strings["_"]||isNaN(b)?i:b)}}Object.keys(u).forEach((function(e){if(!(e in r)){r[e]=u[e];e in a&&(r[a[e]]=u[e])}}));c._&&r._.length<c._&&fail("Not enough non-option arguments: got "+r._.length+", need at least "+c._);var y=[];Object.keys(c).forEach((function(e){r[e]||y.push(e)}));y.length&&fail("Missing required arguments: "+y.join(", "));f.forEach((function(e){try{false===e(r)&&fail("Argument check failed: "+e.toString())}catch(e){fail(e)}}));return r}function longest(e){return Math.max.apply(null,e.map((function(e){return e.length})))}return t}n.rebase=rebase;function rebase(e,r){var t=i.normalize(r).split("/").slice(1);var n=i.normalize(e).split("/").slice(1);for(var a=0;t[a]&&t[a]==n[a];a++);t.splice(0,a);n.splice(0,a);var o=i.normalize(n.map((function(){return".."})).concat(t).join("/")).replace(/\/$/,"").replace(/^$/,".");return o.match(/^[.\/]/)?o:"./"+o}function setKey(e,r,t){var n=e;r.slice(0,-1).forEach((function(e){void 0===n[e]&&(n[e]={});n=n[e]}));var a=r[r.length-1];void 0===n[a]||"boolean"===typeof n[a]?n[a]=t:Array.isArray(n[a])?n[a].push(t):n[a]=[n[a],t]}var l=a.exports;const f=a.exports.rebase;export default l;export{f as rebase};

